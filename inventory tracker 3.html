<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f5f5;
            padding: 10px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            overflow: visible;
        }

        .header {
            background: #333;
            color: white;
            padding: 15px;
            text-align: center;
        }

        .tabs {
            display: flex;
            background: #eee;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            font-size: 14px;
            cursor: pointer;
            color: #666;
            min-width: 80px;
        }

        .tab.active {
            background: white;
            color: #333;
            font-weight: bold;
        }

        .content {
            padding: 15px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        input:focus, textarea:focus {
            border-color: #007bff;
            outline: none;
        }

        .btn {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            font-weight: bold;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .btn:active {
            background: #0056b3;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-copy {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .btn-ordered {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .suggestions {
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            position: absolute;
            width: calc(100% - 30px);
            z-index: 9999;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .suggestion {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }

        .suggestion:hover, .suggestion.selected {
            background: #f0f0f0;
        }

        .suggestion:last-child {
            border-bottom: none;
        }

        .supplier-section {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .supplier-header {
            background: #007bff;
            color: white;
            padding: 12px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .supplier-info {
            flex: 1;
        }

        .supplier-buttons {
            display: flex;
            gap: 5px;
        }

        .supplier-contact {
            font-size: 14px;
            opacity: 0.9;
        }

        .item-count {
            font-size: 12px;
            opacity: 0.85;
            font-weight: normal;
        }

        .item {
            padding: 10px 12px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item:last-child {
            border-bottom: none;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .supplier-card {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .supplier-buttons-card {
            margin-top: 10px;
        }

        .btn-edit {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
        }

        .supplier-items {
            margin-top: 10px;
            font-size: 14px;
            color: #666;
        }

        .empty {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        .recent-add {
            background: #28a745;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }

        .input-container {
            position: relative;
        }

        .unknown-supplier {
            background: #ffc107;
        }

        .export-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        .export-section h3 {
            margin-bottom: 10px;
            color: #333;
        }



        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .header {
                padding: 10px;
                font-size: 18px;
            }
            
            .tab {
                padding: 10px 8px;
                font-size: 12px;
            }
            
            .content {
                padding: 10px;
            }

            .supplier-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .supplier-buttons {
                margin-top: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Inventory Tracker</h1>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('quick')">Add Item</button>
            <button class="tab" onclick="showTab('orders')">Orders</button>
            <button class="tab" onclick="showTab('ordered')">Yesterday</button>
            <button class="tab" onclick="showTab('setup')">Setup</button>
        </div>

        <div class="content">
            <div id="quick-tab" class="tab-content active">
                <div class="input-container">
                    <input type="text" id="quick-input" placeholder="Type: butter, cod, etc..." />
                    <div id="suggestions" class="suggestions"></div>
                </div>
                <button class="btn" onclick="addItem()">Add</button>
                
                <div id="recent" style="display: none;">
                    <div id="recent-msg" class="recent-add"></div>
                </div>
            </div>

            <div id="orders-tab" class="tab-content">
                <div id="orders-content">
                    <div class="empty">No items to order yet</div>
                </div>
            </div>

            <div id="ordered-tab" class="tab-content">
                <div id="ordered-content">
                    <div class="empty">No orders from yesterday</div>
                </div>
                <button class="btn btn-danger" onclick="clearOrderedItems()" style="margin-top: 10px;">Clear Yesterday's Orders</button>
            </div>

            <div id="setup-tab" class="tab-content">
                <input type="text" id="supplier-name" placeholder="Supplier name" />
                <input type="text" id="supplier-phone" placeholder="Phone number" />
                <input type="text" id="supplier-contact" placeholder="Contact person" />
                <textarea id="supplier-items" placeholder="Items (comma separated): cod, salmon, shrimp" rows="3"></textarea>
                <button class="btn" onclick="addSupplier()">Add Supplier</button>
                
                <div id="suppliers-list">
                    <div class="empty">No suppliers yet</div>
                </div>

                <div class="export-section">
                    <h3>Export/Import Config</h3>
                    <button class="btn btn-success" onclick="exportConfig()">ðŸ“¥ Export Suppliers (JSON)</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">ðŸ“¤ Import Suppliers (JSON)</button>
                    <input type="file" id="import-file" accept=".json" onchange="importConfig(event)" style="display: none;" />
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let suppliers = [];
        let neededItems = [];
        let orderedItems = [];
        let selectedSuggestionIndex = -1;

        window.onload = function() {
            loadData();
            renderAll();
        };

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function findSupplier(itemName) {
            const search = itemName.toLowerCase().trim();
            
            // First pass: exact match
            for (let supplier of suppliers) {
                for (let item of supplier.items) {
                    if (item.toLowerCase() === search) {
                        return supplier;
                    }
                }
            }
            
            // Second pass: partial match (only if item contains search, not the other way)
            for (let supplier of suppliers) {
                for (let item of supplier.items) {
                    if (item.toLowerCase().includes(search)) {
                        return supplier;
                    }
                }
            }
            
            return null;
        }

        function showSuggestions() {
            const input = document.getElementById('quick-input');
            const suggestionsDiv = document.getElementById('suggestions');
            const query = input.value.toLowerCase().trim();

            if (query.length < 1) {
                suggestionsDiv.style.display = 'none';
                selectedSuggestionIndex = -1;
                return;
            }

            let suggestions = [];
            
            // Exact matches first
            suppliers.forEach(supplier => {
                supplier.items.forEach(item => {
                    if (item.toLowerCase() === query) {
                        suggestions.push({ item, supplier, priority: 1 });
                    }
                });
            });
            
            // Partial matches second
            suppliers.forEach(supplier => {
                supplier.items.forEach(item => {
                    if (item.toLowerCase().includes(query) && item.toLowerCase() !== query) {
                        suggestions.push({ item, supplier, priority: 2 });
                    }
                });
            });

            if (suggestions.length > 0) {
                suggestionsDiv.innerHTML = suggestions.map((s, index) => 
                    `<div class="suggestion ${index === selectedSuggestionIndex ? 'selected' : ''}" onclick="selectItem('${s.item.replace(/'/g, "\\'")}')">
                        ${s.item} (${s.supplier.name})
                    </div>`
                ).join('');
                suggestionsDiv.style.display = 'block';
                selectedSuggestionIndex = -1;
            } else {
                suggestionsDiv.style.display = 'none';
                selectedSuggestionIndex = -1;
            }
        }

        function selectItem(item) {
            document.getElementById('quick-input').value = item;
            document.getElementById('suggestions').style.display = 'none';
            selectedSuggestionIndex = -1;
            addItem();
        }

        function addItem() {
            const input = document.getElementById('quick-input');
            const itemName = input.value.trim();

            if (!itemName) return;

            const supplier = findSupplier(itemName);
            const supplierId = supplier ? supplier.id : null;
            const supplierName = supplier ? supplier.name : 'Unknown';

            // Check if already exists
            const exists = neededItems.find(item => 
                item.name.toLowerCase() === itemName.toLowerCase() && 
                item.supplierId === supplierId
            );

            if (!exists) {
                neededItems.push({
                    id: Date.now(),
                    name: itemName,
                    supplierId: supplierId,
                    supplierName: supplierName
                });
                
                saveData();
                showRecent(`Added "${itemName}" â†’ ${supplierName}`);
            }

            input.value = '';
            document.getElementById('suggestions').style.display = 'none';
            selectedSuggestionIndex = -1;
            renderOrders();
            input.focus();
        }

        function showRecent(message) {
            const recentDiv = document.getElementById('recent');
            const msgDiv = document.getElementById('recent-msg');
            
            msgDiv.textContent = message;
            recentDiv.style.display = 'block';
            
            setTimeout(() => {
                recentDiv.style.display = 'none';
            }, 2000);
        }

        function removeItem(id) {
            neededItems = neededItems.filter(item => item.id !== id);
            saveData();
            renderOrders();
        }

        function markAsOrdered(supplierId) {
            const itemsToMove = neededItems.filter(item => item.supplierId == supplierId);
            const supplier = suppliers.find(s => s.id == supplierId);
            
            if (itemsToMove.length > 0 && supplier) {
                const orderGroup = {
                    id: Date.now(),
                    supplierId: supplierId,
                    supplierName: supplier.name,
                    supplierPhone: supplier.phone,
                    supplierContact: supplier.contact,
                    items: itemsToMove.map(item => item.name),
                    orderedDate: new Date().toLocaleDateString()
                };
                
                orderedItems.push(orderGroup);
                neededItems = neededItems.filter(item => item.supplierId != supplierId);
                
                saveData();
                renderOrders();
                renderOrdered();
            }
        }

        function copySupplierList(supplierId) {
            const items = neededItems.filter(item => item.supplierId == supplierId);
            const supplier = suppliers.find(s => s.id == supplierId);
            
            if (items.length > 0 && supplier) {
                const itemNames = items.map(item => item.name).join(', ');
                const textToCopy = `${supplier.name}: ${itemNames}${supplier.phone ? ` (${supplier.phone})` : ''}`;
                
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showRecent(`Copied: ${supplier.name} list`);
                }).catch(() => {
                    showRecent(`${supplier.name}: ${itemNames}`);
                });
            }
        }

        function clearOrderedItems() {
            if (confirm('Clear all yesterday\'s orders?')) {
                orderedItems = [];
                saveData();
                renderOrdered();
            }
        }

        function addSupplier() {
            const name = document.getElementById('supplier-name').value.trim();
            const phone = document.getElementById('supplier-phone').value.trim();
            const contact = document.getElementById('supplier-contact').value.trim();
            const itemsText = document.getElementById('supplier-items').value.trim();

            if (!name || !itemsText) {
                alert('Need supplier name and items');
                return;
            }

            // Check for duplicate supplier name
            const duplicate = suppliers.find(s => s.name.toLowerCase() === name.toLowerCase());
            if (duplicate) {
                alert(`Supplier "${name}" already exists!`);
                return;
            }

            const items = itemsText.split(',').map(item => item.trim()).filter(item => item);

            suppliers.push({
                id: Date.now(),
                name,
                phone,
                contact,
                items
            });

            saveData();

            document.getElementById('supplier-name').value = '';
            document.getElementById('supplier-phone').value = '';
            document.getElementById('supplier-contact').value = '';
            document.getElementById('supplier-items').value = '';

            renderSuppliers();
            showRecent(`Added supplier: ${name}`);
        }

        function editSupplier(id) {
            const supplier = suppliers.find(s => s.id === id);
            if (!supplier) return;

            document.getElementById('supplier-name').value = supplier.name;
            document.getElementById('supplier-phone').value = supplier.phone || '';
            document.getElementById('supplier-contact').value = supplier.contact || '';
            document.getElementById('supplier-items').value = supplier.items.join(', ');

            suppliers = suppliers.filter(s => s.id !== id);
            
            neededItems.forEach(item => {
                if (item.supplierId === id) {
                    item.supplierId = null;
                    item.supplierName = 'Unknown';
                }
            });

            saveData();
            renderAll();
            
            document.getElementById('supplier-name').focus();
        }

        function deleteSupplier(id) {
            if (confirm('Delete supplier?')) {
                suppliers = suppliers.filter(s => s.id !== id);
                neededItems = neededItems.filter(item => item.supplierId !== id);
                saveData();
                renderAll();
            }
        }

        function clearAllItems() {
            if (confirm('Clear all items?')) {
                neededItems = [];
                saveData();
                renderOrders();
            }
        }

        function exportConfig() {
            const config = {
                version: "1.0",
                exportDate: new Date().toISOString(),
                suppliers: suppliers
            };
            
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `inventory-config-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showRecent('Config exported! Check your downloads.');
        }

        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    
                    if (!config.suppliers || !Array.isArray(config.suppliers)) {
                        alert('Invalid config file format!');
                        return;
                    }
                    
                    const imported = config.suppliers.length;
                    let added = 0;
                    let skipped = 0;
                    
                    config.suppliers.forEach(supplier => {
                        const duplicate = suppliers.find(s => 
                            s.name.toLowerCase() === supplier.name.toLowerCase()
                        );
                        
                        if (!duplicate) {
                            suppliers.push({
                                id: Date.now() + Math.random(),
                                name: supplier.name,
                                phone: supplier.phone || '',
                                contact: supplier.contact || '',
                                items: supplier.items || []
                            });
                            added++;
                        } else {
                            skipped++;
                        }
                    });
                    
                    saveData();
                    renderSuppliers();
                    
                    showRecent(`Imported: ${added} added, ${skipped} skipped (duplicates)`);
                } catch (error) {
                    alert('Error reading config file!');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }

        function renderOrders() {
            const container = document.getElementById('orders-content');
            
            if (neededItems.length === 0) {
                container.innerHTML = '<div class="empty">No items to order yet</div>';
                return;
            }

            const grouped = {};
            neededItems.forEach(item => {
                const key = item.supplierId || 'unknown';
                if (!grouped[key]) grouped[key] = [];
                grouped[key].push(item);
            });

            let html = '<button class="btn btn-danger" onclick="clearAllItems()">Clear All</button>';
            
            Object.keys(grouped).forEach(supplierId => {
                const items = grouped[supplierId];
                const supplier = suppliers.find(s => s.id == supplierId);
                
                if (supplier) {
                    html += `
                        <div class="supplier-section">
                            <div class="supplier-header">
                                <div class="supplier-info">
                                    ${supplier.name} <span class="item-count">(${items.length} items)</span>
                                    <div class="supplier-contact">
                                        ${supplier.phone || ''} ${supplier.contact || ''}
                                    </div>
                                </div>
                                <div class="supplier-buttons">
                                    <button class="btn-copy" onclick="copySupplierList(${supplierId})">Copy</button>
                                    <button class="btn-ordered" onclick="markAsOrdered(${supplierId})">Ordered</button>
                                </div>
                            </div>
                            ${items.map(item => `
                                <div class="item">
                                    <span>${item.name}</span>
                                    <button class="remove-btn" onclick="removeItem(${item.id})">Ã—</button>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    html += `
                        <div class="supplier-section">
                            <div class="supplier-header unknown-supplier">
                                <div class="supplier-info">Unknown Supplier <span class="item-count">(${items.length} items)</span></div>
                            </div>
                            ${items.map(item => `
                                <div class="item">
                                    <span>${item.name}</span>
                                    <button class="remove-btn" onclick="removeItem(${item.id})">Ã—</button>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            });

            container.innerHTML = html;
        }

        function renderOrdered() {
            const container = document.getElementById('ordered-content');
            
            if (orderedItems.length === 0) {
                container.innerHTML = '<div class="empty">No orders from yesterday</div>';
                return;
            }

            const html = orderedItems.map(order => `
                <div class="supplier-section">
                    <div class="supplier-header">
                        <div class="supplier-info">
                            ${order.supplierName} (${order.orderedDate}) <span class="item-count">(${order.items.length} items)</span>
                            <div class="supplier-contact">
                                ${order.supplierPhone || ''} ${order.supplierContact || ''}
                            </div>
                        </div>
                    </div>
                    ${order.items.map(itemName => `
                        <div class="item">
                            <span>${itemName}</span>
                        </div>
                    `).join('')}
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function renderSuppliers() {
            const container = document.getElementById('suppliers-list');
            
            if (suppliers.length === 0) {
                container.innerHTML = '<div class="empty">No suppliers yet</div>';
                return;
            }

            const html = suppliers.map(supplier => `
                <div class="supplier-card">
                    <strong>${supplier.name}</strong>
                    ${supplier.phone ? `<br>ðŸ“ž ${supplier.phone}` : ''}
                    ${supplier.contact ? `<br>ðŸ‘¤ ${supplier.contact}` : ''}
                    <div class="supplier-items">Items: ${supplier.items.join(', ')}</div>
                    <div class="supplier-buttons-card">
                        <button class="btn-edit" onclick="editSupplier(${supplier.id})">Edit</button>
                        <button class="remove-btn" onclick="deleteSupplier(${supplier.id})">Delete</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function renderAll() {
            renderOrders();
            renderSuppliers();
            renderOrdered();
        }

        function saveData() {
            localStorage.setItem('suppliers', JSON.stringify(suppliers));
            localStorage.setItem('neededItems', JSON.stringify(neededItems));
            localStorage.setItem('orderedItems', JSON.stringify(orderedItems));
        }

        function loadData() {
            const savedSuppliers = localStorage.getItem('suppliers');
            const savedItems = localStorage.getItem('neededItems');
            const savedOrdered = localStorage.getItem('orderedItems');
            
            if (savedSuppliers) {
                suppliers = JSON.parse(savedSuppliers);
            }
            
            if (savedItems) {
                neededItems = JSON.parse(savedItems);
            }
            
            if (savedOrdered) {
                orderedItems = JSON.parse(savedOrdered);
            }
        }

        // Event listeners
        document.getElementById('quick-input').addEventListener('input', showSuggestions);
        
        document.getElementById('quick-input').addEventListener('keydown', function(e) {
            const suggestionsDiv = document.getElementById('suggestions');
            const suggestions = suggestionsDiv.querySelectorAll('.suggestion');
            
            if (suggestionsDiv.style.display === 'none' || suggestions.length === 0) {
                if (e.key === 'Enter') {
                    addItem();
                }
                return;
            }
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedSuggestionIndex = Math.min(selectedSuggestionIndex + 1, suggestions.length - 1);
                updateSelectedSuggestion(suggestions);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedSuggestionIndex = Math.max(selectedSuggestionIndex - 1, 0);
                updateSelectedSuggestion(suggestions);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (selectedSuggestionIndex >= 0 && selectedSuggestionIndex < suggestions.length) {
                    suggestions[selectedSuggestionIndex].click();
                } else {
                    addItem();
                }
            } else if (e.key === 'Escape') {
                suggestionsDiv.style.display = 'none';
                selectedSuggestionIndex = -1;
            }
        });

        function updateSelectedSuggestion(suggestions) {
            suggestions.forEach((s, i) => {
                if (i === selectedSuggestionIndex) {
                    s.classList.add('selected');
                    s.scrollIntoView({ block: 'nearest' });
                } else {
                    s.classList.remove('selected');
                }
            });
        }

        document.addEventListener('click', function(e) {
            if (!e.target.closest('.input-container')) {
                document.getElementById('suggestions').style.display = 'none';
                selectedSuggestionIndex = -1;
            }
        });
    </script>
</body>
</html>